From 49dfdc152cbdeb22312972dfdc86d3b90d6097f0 Mon Sep 17 00:00:00 2001
From: Yuta NAKAI <nak5124@live.jp>
Date: Thu, 16 Oct 2014 22:07:58 +0900
Subject: [PATCH 56/62] avcodec/libvpxenc: Use VP9E_SET_NOISE_SENSITIVITY for
 vp9 noise_reduction.

See http://git.chromium.org/gitweb/?p=webm/libvpx.git;a=commit;h=bb1a23656c63097a4b250ac484b14051f09df9b5
---
 libavcodec/libvpxenc.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/libavcodec/libvpxenc.c b/libavcodec/libvpxenc.c
index 4cb0e21..0c0b9c0 100644
--- a/libavcodec/libvpxenc.c
+++ b/libavcodec/libvpxenc.c
@@ -126,6 +126,7 @@ static const char *const ctlidstr[] = {
     [VP9E_SET_TILE_ROWS]               = "VP9E_SET_TILE_ROWS",
     [VP9E_SET_FRAME_PARALLEL_DECODING] = "VP9E_SET_FRAME_PARALLEL_DECODING",
     [VP9E_SET_AQ_MODE]                 = "VP9E_SET_AQ_MODE",
+    [VP9E_SET_NOISE_SENSITIVITY]       = "VP9E_SET_NOISE_SENSITIVITY",
 #endif
 };
 
@@ -441,7 +442,8 @@ static av_cold int vpx_init(AVCodecContext *avctx,
         codecctl_int(avctx, VP8E_SET_ARNR_STRENGTH,    ctx->arnr_strength);
     if (ctx->arnr_type >= 0)
         codecctl_int(avctx, VP8E_SET_ARNR_TYPE,        ctx->arnr_type);
-    codecctl_int(avctx, VP8E_SET_NOISE_SENSITIVITY, avctx->noise_reduction);
+    if (avctx->codec_id == AV_CODEC_ID_VP8)
+        codecctl_int(avctx, VP8E_SET_NOISE_SENSITIVITY, avctx->noise_reduction);
     if (avctx->codec_id == AV_CODEC_ID_VP8)
         codecctl_int(avctx, VP8E_SET_TOKEN_PARTITIONS,  av_log2(avctx->slices));
 #if FF_API_MPV_OPT
@@ -461,6 +463,7 @@ static av_cold int vpx_init(AVCodecContext *avctx,
 
 #if CONFIG_LIBVPX_VP9_ENCODER
     if (avctx->codec_id == AV_CODEC_ID_VP9) {
+        codecctl_int(avctx, VP9E_SET_NOISE_SENSITIVITY, avctx->noise_reduction);
         if (ctx->lossless >= 0)
             codecctl_int(avctx, VP9E_SET_LOSSLESS, ctx->lossless);
         if (ctx->tile_columns >= 0)
-- 
2.3.0

