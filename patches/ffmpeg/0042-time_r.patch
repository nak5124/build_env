diff --git a/configure b/configure
index 40d1f07..e68b9d2 100755
--- a/configure
+++ b/configure
@@ -4216,7 +4216,7 @@ probe_libc(){
             add_compat msvcrt/snprintf.o
             add_cflags "-include $source_path/compat/msvcrt/snprintf.h"
         fi
-        add_${pfx}cppflags -U__STRICT_ANSI__ -D__USE_MINGW_ANSI_STDIO=1
+        add_${pfx}cppflags -U__STRICT_ANSI__ -D__USE_MINGW_ANSI_STDIO=1 -D_POSIX
         eval test \$${pfx_no_}cc_type = "gcc" &&
             add_${pfx}cppflags -D__printf__=__gnu_printf__
     elif check_${pfx}cpp_condition _mingw.h "defined __MINGW_VERSION"  ||
@@ -4700,9 +4700,9 @@ check_func  gethrtime
 check_func  getopt
 check_func  getrusage
 check_func  gettimeofday
-check_func  gmtime_r
+check_func  gmtime_r || { check_code cc time.h "time_t time; struct tm tmbuf, *tm = gmtime_r(&time, &tmbuf);" && enable gmtime_r; }
 check_func  isatty
-check_func  localtime_r
+check_func  localtime_r || { check_code cc time.h "time_t time; struct tm tmbuf, *tm = localtime_r(&time, &tmbuf);" && enable localtime_r; }
 check_func  mach_absolute_time
 check_func  mkstemp
 check_func  mmap
