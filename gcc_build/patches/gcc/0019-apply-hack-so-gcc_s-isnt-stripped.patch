--- gcc-4.9.2/gcc/config/i386/cygwin.h.old      2014-11-04 21:44:44.792572900 +0900
+++ gcc-4.9.2/gcc/config/i386/cygwin.h  2014-11-04 21:45:11.813118400 +0900
@@ -48,6 +48,10 @@
    %{!shared:%:if-exists(default-manifest.o%s)}\
    crtend.o%s"
 
+/* There is a bug when building i686 dw-2 exceptions
+   where gcc_s gets stripped which this works around */
+#define PREVENT_STRIP_REG_FRAME_INFO "--undefined=___deregister_frame_info --undefined=___register_frame_info"
+
 /* Normally, -lgcc is not needed since everything in it is in the DLL, but we
    want to allow things to be added to it when installing new versions of
    GCC without making a new CYGWIN.DLL, so we leave it.  Profiling is handled
@@ -58,7 +62,7 @@
  %{static|static-libgcc:-lgcc -lgcc_eh} \
  %{!static: \
    %{!static-libgcc: \
-     -lgcc_s -lgcc \
+     -lgcc_s " PREVENT_STRIP_REG_FRAME_INFO " -lgcc \
     } \
   } "
 #else
--- gcc-4.9.2/gcc/config/i386/mingw32.h.old     2014-11-04 21:31:18.380448800 +0900
+++ gcc-4.9.2/gcc/config/i386/mingw32.h 2014-11-04 21:35:50.929037700 +0900
@@ -118,8 +118,12 @@
 #endif
 #define SHARED_LIBGCC_UNDEFS_SPEC \
  "%{shared-libgcc: -u ___register_frame_info -u ___deregister_frame_info}"
+/* There is a bug when building i686 dw-2 exceptions
+   where gcc_s gets stripped which this works around */
+#define PREVENT_STRIP_REG_FRAME_INFO "--undefined=___deregister_frame_info --undefined=___register_frame_info"
 #else
 #define SHARED_LIBGCC_UNDEFS_SPEC ""
+#define PREVENT_STRIP_REG_FRAME_INFO ""
 #endif
 
 #undef  SUBTARGET_EXTRA_SPECS
@@ -144,9 +148,9 @@
    %{!static-libgcc: \
      %{!shared: \
        %{!shared-libgcc:-lgcc -lgcc_eh} \
-       %{shared-libgcc:-lgcc_s -lgcc} \
+       %{shared-libgcc:-lgcc_s " PREVENT_STRIP_REG_FRAME_INFO " -lgcc} \
       } \
-     %{shared:-lgcc_s -lgcc} \
+     %{shared:-lgcc_s " PREVENT_STRIP_REG_FRAME_INFO " -lgcc} \
     } \
   } "
 #else
