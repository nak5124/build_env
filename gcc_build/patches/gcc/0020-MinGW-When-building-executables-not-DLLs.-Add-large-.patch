From 27c93a76bb521fa00dd2cb46886b1cda3f75538b Mon Sep 17 00:00:00 2001
From: Yuta NAKAI <nak5124@live.jp>
Date: Sun, 12 Apr 2015 14:38:53 +0900
Subject: [PATCH 20/29] MinGW: When building executables, not DLLs. Add
 --large-address-aware and --tsaware.

---
 gcc/config/i386/mingw-w64.h | 3 ++-
 gcc/config/i386/mingw32.h   | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/gcc/config/i386/mingw-w64.h b/gcc/config/i386/mingw-w64.h
index 578a7b7c..3d00bec 100644
--- a/gcc/config/i386/mingw-w64.h
+++ b/gcc/config/i386/mingw-w64.h
@@ -88,4 +88,5 @@ along with GCC; see the file COPYING3.  If not see
   %{shared: --shared} %{mdll:--dll} \
   %{static:-Bstatic} %{!static:-Bdynamic} \
   %{shared|mdll: " SUB_LINK_ENTRY " --enable-auto-image-base} \
-  %(shared_libgcc_undefs)"
+  %(shared_libgcc_undefs) \
+  %{!shared: %{!mdll: %{" SPEC_32 ": --large-address-aware} --tsaware}}"
diff --git a/gcc/config/i386/mingw32.h b/gcc/config/i386/mingw32.h
index a8b2df4..68a736c 100644
--- a/gcc/config/i386/mingw32.h
+++ b/gcc/config/i386/mingw32.h
@@ -118,7 +118,8 @@ along with GCC; see the file COPYING3.  If not see
   %{shared: --shared} %{mdll:--dll} \
   %{static:-Bstatic} %{!static:-Bdynamic} \
   %{shared|mdll: " SUB_LINK_ENTRY " --enable-auto-image-base} \
-  %(shared_libgcc_undefs)"
+  %(shared_libgcc_undefs) \
+  %{!shared: %{!mdll: --large-address-aware --tsaware}}"
 
 /* There is a bug when building i686 dw-2 exceptions
    where gcc_s gets stripped which this works around */
-- 
2.7.3

